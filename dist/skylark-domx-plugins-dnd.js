/**
 * skylark-domx-plugins-dnd - The dnd features enhancement for dom.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){var r=e.define,require=e.require,a="function"==typeof r&&r.amd,n=!a&&"undefined"!=typeof exports;if(!a&&!r){var s={};r=e.define=function(t,e,r){"function"==typeof r?(s[t]={factory:r,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var r=e.split("/"),a=t.split("/");r.pop();for(var n=0;n<a.length;n++)"."!=a[n]&&(".."==a[n]?r.pop():r.push(a[n]));return r.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):s[t]={factory:null,resolved:!0,exports:r}},require=e.require=function(t){if(!s.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=s[t];if(!module.resolved){var r=[];module.deps.forEach(function(t){r.push(require(t))}),module.exports=module.factory.apply(e,r)||null,module.resolved=!0}return module.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-domx-plugins-dnd/dnd",["skylark-domx-plugins-base/plugins"],function(t){return t.dnd={}}),t("skylark-domx-plugins-dnd/fallback/data-transfer",[],function(){"use strict";function t(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(t.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),t.prototype.clearData=function(t){null!=t?delete this._data[t]:this._data=null},t.prototype.getData=function(t){return this._data[t]||""},t.prototype.setData=function(t,e){this._data[t]=e},t.prototype.setDragImage=function(t,e,r){this._imgCustom=t,this._imgOffset={x:e,y:r}},t}),t("skylark-domx-plugins-dnd/fallback/moused-drag-drop",["skylark-langx","skylark-domx-noder","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-finder","skylark-domx-plugins-scrolls/auto-scroll","./data-transfer"],function(t,e,r,a,n,s,i,o){"use strict";var l=t.Emitter.inherit({_construct:function(t,e,a){this.dnd=t,this._dragSource=e,this._ptDown=a,this._lastClick=0,this._isDragEnabled=!0,this._dataTransfer=new o;var n=r(document);this.listenTo(n,"mousemove",this._onMouseMove),this.listenTo(n,"mouseup",this._onMouseUp)},_onMouseMove:function(t){if(this._shouldCancelPressHoldMove(t))this._reset();else if(this._shouldHandleMove(t)||this._shouldHandlePressHoldMove(t)){var e=this._getTarget(t);this._dragSource&&!this._img&&this._shouldStartDragging(t)&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",e)),this._img&&(this._lastTouch=t,t.preventDefault(),e!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",e),this._lastTarget=e),this._moveImage(t),this._isDropZone=this._dispatchEvent(t,"dragover",e)),this._handleAutoScroll(t)}},_onMouseUp:function(t){this._shouldHandle(t)&&(this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource))),this.destroy()},_shouldHandle:function(t){return t&&!t.defaultPrevented},_shouldHandleMove:function(t){return!l._ISPRESSHOLDMODE&&this._shouldHandle(t)},_shouldHandlePressHoldMove:function(t){return l._ISPRESSHOLDMODE&&this._isDragEnabled},_shouldCancelPressHoldMove:function(t){return l._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(t)>l._PRESSHOLDMARGIN},_shouldStartDragging:function(t){var e=this._getDelta(t);return e>l._THRESHOLD||l._ISPRESSHOLDMODE&&e>=l._PRESSHOLDTHRESHOLD},_reset:function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=null,clearInterval(this._pressHoldInterval),this.pointerElemChangedInterval&&(clearInterval(this.pointerElemChangedInterval),this.pointerElemChangedInterval=null),this.autoscroller&&(this.autoscroller.destroy(),this.autoscroller=null)},_getPoint:function(t,e){return{x:e?t.pageX:t.clientX,y:e?t.pageY:t.clientY}},_getDelta:function(t){if(l._ISPRESSHOLDMODE&&!this._ptDown)return 0;var e=this._getPoint(t);return Math.abs(e.x-this._ptDown.x)+Math.abs(e.y-this._ptDown.y)},_getTarget:function(t){for(var e=this._getPoint(t),r=document.elementFromPoint(e.x,e.y);r&&"none"==getComputedStyle(r).pointerEvents;)r=r.parentElement;return r},_createImage:function(t){this._img&&this._destroyImage(),this._imgCustom=this._dataTransfer._imgCustom,this._imgOffset=this._dataTransfer._imgOffset;var e=this._imgCustom||this._dragSource;if(this._img=e.cloneNode(!0),this._copyStyle(e,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var r=e.getBoundingClientRect(),a=this._getPoint(t);this._imgOffset={x:a.x-r.left,y:a.y-r.top},this._img.style.opacity=l._OPACITY.toString()}this._moveImage(t),document.body.appendChild(this._img)},_destroyImage:function(){this._img&&e.remove(this._img),this._img=null,this._imgCustom=null},_moveImage:function(e){var r=this;t.defer(function(){if(r._img){var t=r._getPoint(e,!0);n.css(r._img,{position:"absolute",pointerEvents:"none",zIndex:"999999",left:Math.round(t.x-r._imgOffset.x)+"px",top:Math.round(t.y-r._imgOffset.y)+"px"})}})},_copyProps:function(t,e,r){for(var a=0;a<r.length;a++){var n=r[a];t[n]=e[n]}},_copyStyle:function(t,e){if(l._rmvAtts.forEach(function(t){e.removeAttribute(t)}),t instanceof HTMLCanvasElement){var r=t,a=e;a.width=r.width,a.height=r.height,a.getContext("2d").drawImage(r,0,0)}for(var n=getComputedStyle(t),s=0;s<n.length;s++){var i=n[s];i.indexOf("transition")<0&&(e.style[i]=n[i])}e.style.pointerEvents="none";for(var s=0;s<t.children.length;s++)this._copyStyle(t.children[s],e.children[s])},_dispatchEvent:function(t,e,r){if(t&&r){var a=document.createEvent("Event"),n=t.touches?t.touches[0]:t;return a.initEvent(e,!0,!0),a.button=0,a.which=a.buttons=1,this._copyProps(a,t,l._kbdProps),this._copyProps(a,n,l._ptProps),a.dataTransfer=this._dataTransfer,r.dispatchEvent(a),a.defaultPrevented}return!1},_closestDraggable:function(t){for(;t;t=t.parentElement)if(t.hasAttribute("data-draggable"))return t;return null},_handleAutoScroll:function(t){var e=this.dnd,r=t.clientX,a=t.clientY;document.elementFromPoint(r,a);if(!this.pointerElemChangedInterval||r!==this.lastPointerElemX||a!==this.lastPointerElemY){this.pointerElemChangedInterval&&clearInterval(this.pointerElemChangedInterval);var n=null;this.pointerElemChangedInterval=setInterval(function(){var t=s.scrollableParent(document.elementFromPoint(r,a),!0);t!==n&&(n=t,this.autoscroller&&(this.autoscroller.destroy(),this.autoscroller=null),this.autoscroller=new i(n,e.dragging.options),this.autoscroller.handle(r,a))},10),this.lastPointerElemX=r,this.lastPointerElemY=a}},destroy:function(){this.unlistenTo(),this._reset()}});return l._THRESHOLD=5,l._OPACITY=.5,l._DBLCLICK=500,l._CTXMENU=900,l._ISPRESSHOLDMODE=!1,l._PRESSHOLDAWAIT=400,l._PRESSHOLDMARGIN=25,l._PRESSHOLDTHRESHOLD=0,l._rmvAtts="id,class,style,draggable".split(","),l._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),l._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),l}),t("skylark-domx-plugins-dnd/manager",["skylark-langx/langx","skylark-langx-hoster/is-mobile","skylark-domx-noder","skylark-domx-data","skylark-domx-finder","skylark-domx-geom","skylark-domx-eventer","skylark-domx-styler","./dnd","./fallback/moused-drag-drop"],function(t,e,r,a,n,s,i,o,l,d){i.on,i.off,a.attr,a.removeAttr,s.pagePosition,o.addClass,s.height;var g="draggable"in document.createElement("div")&&!e.apple.device,u=l.Manager=t.Evented.inherit({klassName:"Manager",init:function(){},prepare:function(t,e){var r=i.create("preparing",{dragSource:t.dragSource,dragHandle:t.dragHandle,originalEvent:e});if(t.trigger(r),t.dragSource=r.dragSource,t.dragHandle=r.dragHandle,t.dragSource){this.useNativeDnd=!t.options.forceFallback&&g,this.dragging=t,a.data(t.dragSource,"draggable",!0),this.useNativeDnd?a.attr(t.dragSource,"draggable","true"):this._fallbacker=new d(this,t.dragSource,t.startPos);try{document.selection?document.selection.empty():window.getSelection().removeAllRanges()}catch(t){}}},start:function(e,r){a.data(e.dragSource,"draggable",!1),this.useNativeDnd&&a.attr(e.dragSource,"draggable","false");var n=s.pagePosition(e.dragSource);this.draggingOffsetX=parseInt(r.pageX-n.left),this.draggingOffsetY=parseInt(r.pageY-n.top);var l=i.create("started",{elm:e.elm,dragSource:e.dragSource,dragHandle:e.dragHandle,ghost:null,originalEvent:r,transfer:{}});e.trigger(l),this.dragging=e,e.draggingClass&&o.addClass(e.dragSource,e.draggingClass),this.draggingGhost=l.ghost,this.draggingGhost||(this.draggingGhost=e.dragSource),this.draggingTransfer=l.transfer,this.draggingTransfer&&t.each(this.draggingTransfer,function(t,e){r.dataTransfer.setData(t,e)}),r.dataTransfer.setDragImage(this.draggingGhost,this.draggingOffsetX,this.draggingOffsetY);var d=i.create("dndStarted",{elm:l.elm,dragSource:l.dragSource,dragHandle:l.dragHandle,ghost:l.ghost,transfer:l.transfer,dragging:this.dragging});this.trigger(d)},over:function(){},end:function(t){var e=this.dragging;e&&e.draggingClass&&o.removeClass(e.dragSource,e.draggingClass);var r=i.create("ended",{originalEvent:a});this.dragging.trigger(r);var a=i.create("dndEnded",{});this.trigger(a),this.dragging=null,this.draggingTransfer=null,this.draggingGhost=null,this.draggingOffsetX=null,this.draggingOffsetY=null}}),h=new u;return h}),t("skylark-domx-plugins-dnd/Draggable",["skylark-langx/langx","skylark-domx-noder","skylark-domx-data","skylark-domx-finder","skylark-domx-geom","skylark-domx-eventer","skylark-domx-styler","skylark-devices-points/touch","skylark-domx-plugins-base","./dnd","./manager"],function(t,e,r,a,n,s,i,o,l,d,g){s.on,s.off,r.attr,r.removeAttr,n.pagePosition,i.addClass,n.height;var u=l.Plugin.inherit({klassName:"Draggable",pluginName:"lark.dnd.draggable",options:{draggingClass:"dragging",forceFallback:!1},_construct:function(e,r){this.overrided(e,r);var n=this,r=this.options;n.draggingClass=r.draggingClass,["preparing","started","ended","moving"].forEach(function(e){t.isFunction(r[e])&&n.on(e,r[e])}),o.mousy(e),s.on(e,{mousedown:function(e){var r=n.options;r.handle&&(t.isFunction(r.handle)?n.dragHandle=r.handle(e.target,n._elm):n.dragHandle=a.closest(e.target,r.handle,n._elm),!n.dragHandle)||(r.source?t.isFunction(r.source)?n.dragSource=r.source(e.target,n._elm):n.dragSource=a.closest(e.target,r.source,n._elm):n.dragSource=n._elm,n.startPos={x:e.clientX,y:e.clientY},g.prepare(n,e))},mouseup:function(t){},dragstart:function(t){g.dragging===n&&g.start(n,t)},dragend:function(t){g.dragging===n&&(s.stop(t),g.dragging&&g.end(!1))}})}});return l.register(u,"draggable"),d.Draggable=u}),t("skylark-domx-plugins-dnd/Droppable",["skylark-langx/langx","skylark-domx-noder","skylark-domx-data","skylark-domx-finder","skylark-domx-geom","skylark-domx-eventer","skylark-domx-styler","skylark-domx-plugins-base","./dnd","./manager"],function(t,e,r,a,n,s,i,o,l,d){s.on,s.off,r.attr,r.removeAttr,n.pagePosition,i.addClass,n.height;var g=o.Plugin.inherit({klassName:"Droppable",pluginName:"lark.dnd.droppable",options:{draggingClass:"dragging"},_construct:function(e,r){this.overrided(e,r);var a,n,o=this,r=o.options,l=(r.draggingClass,!0);["started","entered","leaved","dropped","overing"].forEach(function(e){t.isFunction(r[e])&&o.on(e,r[e])}),s.on(e,{dragover:function(t){if(t.stopPropagation(),l){var e=s.create("overing",{originalEvent:t,overElm:t.target,transfer:d.draggingTransfer,acceptable:!0});o.trigger(e),e.acceptable&&t.preventDefault()}},dragenter:function(t){o.options;var e=o._elm,r=s.create("entered",{originalEvent:t,transfer:d.draggingTransfer});o.trigger(r),t.stopPropagation(),a&&l&&i.addClass(e,a)},dragleave:function(t){o.options;var e=o._elm;if(!l)return!1;var r=s.create("leaved",{originalEvent:t,transfer:d.draggingTransfer});o.trigger(r),t.stopPropagation(),a&&l&&i.removeClass(e,a)},drop:function(t){o.options;var e=o._elm;if(s.stop(t),d.dragging){a&&l&&i.addClass(e,a);var r=s.create("dropped",{originalEvent:t,transfer:d.draggingTransfer});o.trigger(r),d.end(!0)}}}),d.on("dndStarted",function(t){var r=s.create("started",{transfer:d.draggingTransfer,acceptable:!1,dragging:t.dragging});o.trigger(r),l=r.acceptable,a=r.hoverClass,(n=r.activeClass)&&l&&i.addClass(e,n)}).on("dndEnded",function(t){var r=s.create("ended",{transfer:d.draggingTransfer,acceptable:!1});o.trigger(r),a&&l&&i.removeClass(e,a),n&&l&&i.removeClass(e,n),l=!1,n=null,a=null})}});return o.register(g,"droppable"),l.Droppable=g}),t("skylark-domx-plugins-dnd/main",["./dnd","./Draggable","./Droppable"],function(t){return t}),t("skylark-domx-plugins-dnd",["skylark-domx-plugins-dnd/main"],function(t){return t})}(r),!a){var i=require("skylark-langx-ns");n?module.exports=i:e.skylarkjs=i}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-domx-plugins-dnd.js.map
